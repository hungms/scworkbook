{"title":"Cell Demultiplexing","markdown":{"yaml":{"title":"Cell Demultiplexing","author":[{"name":"Matthew Hung"}],"date":"last-modified","date-format":"iso","format":{"html":{"toc":true,"toc-expand":1,"number-sections":true,"number-offset":3}}},"headingText":"Motivation","headingAttr":{"id":"","classes":["unnumbered"],"keyvalue":[]},"containsRefs":false,"markdown":"\n\n\nFor this dataset, each sample is comprised of cells from multiple patients hashtagged with a unique oligo sequence. To demultiplex which patient the cells were retrieved from, a demultiplexing algorithm must be used to quantify the oligo sequences for each cell and assign each cell to a patient. The most common approaches to date is using the HTOdemux [[Stoeckius et al.; 2018]](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-018-1603-1) or the MULTIseqDemux [[McGinnis et al.; 2019]](https://www.nature.com/articles/s41592-019-0433-8) algorithms. Besides assigning each cell back to each patient, these algorithms are able to identify homolytic/heterolytic \"Doublet\" and \"Negative\" cells based on high/multiple and low oligo counts respectively. These poor quality droplets are a common issue with droplet-based sequencing when there are multiple or no cells found in each droplet, and removal of these droplets could prevent false-positive findings.\n\n## Calculate Gene Fractions {#sec-calculate_gene_fractions}\nBefore demultiplexing, we need to first calculate the fraction of mitochondrial, ribosomal, haemoglobin, T/B-cell recepter (TCR/BCR) and MHC reads to identify poor quality cells, which can be informative of accurate demultiplexing. The function below will perform the calculations of key parameters that identifies poor quality cells.\n  \nPlease navigate to the next chapter \\<Quality Control\\> for a detailed explanation of the wrapper function, outputs, and interpretations.\n\n## Inpect HTO Counts\nBefore demultiplexing HTO library, we will inspect and remove any redundant/low expressing hashtags. For each sample, below we will quantify 1) how many cells expresses each tag; 2) number of counts for each tag.\n\n> Quantification show that Hashtag-1 and Hashtag-2 are pretty much not expressed. Indeed for these sequencing runs, the author did not tag cells with Hashtag-1 and Hashtag-2. However author did not remove these Tags during cellranger-multi processing, hence some false-positive counts.\n\n## HTODemux {#sec-htodemux}\nFirst we will run the the wrapper function below to demultiplex the cells with the HTODemux algorithm in default settings.\n\nBelow we will visualize the output from HTODemux to inspect the quality of the demultiplexing algorithm. We quantified the percentage of \"Singlet\", \"Doublet\" and \"Negative\" cells (empty droplets or cells with no tags) for each sample. \n\n> HTODemux is able to assign > 65% of cells as \"Singlets\" for both samples.\n\nIn addition, we can inspect different parameter below to see if \"Doublet\" and \"Negative\" cells are assigned appropriately. Low nFeature/nCount typically indicate if the droplet is empty, hence \"Negative\". Vice versa, high nFeature/nCount indicate \"Doublet\" cells as mRNA contents in a droplet is doubled.\n\n> Looking at nFeature_RNA & nCounts_RNA mainly, HTODemux assignment do accurately reflect nature of the \"Negative\" and \"Doublet\" cells in our case.\n\n## MULTIseqDemux {#sec-multiseqdemux}\nNext we also will also implement MULTIseqDemux algorithm as a benchmark. \n\nBelow we will visualize the output from MULTIseqDemux to inspect the quality of demultiplexing. Again we quantified the percentage of \"Singlet\", \"Doublet\" and \"Negative\" cells for each sample. \n> Compared to HTODemux, all samples have > 70% of cells assigned as \"Singlet\".\n\nAgain, we can inspect different parameter below to see if \"Doublet\" and \"Negative\" cells are assigned appropriately.\n\n> Looking at nFeature and nCounts again, nCounts and nFeatures of \"Negative\" cells are substantially lower than \"Singlet\" cells, wheres \"Doublets\" are much higher than \"Singlet\" cells. Compared to HTODemux, MULTIseqDemux may better capture true \"Singlet\" cells.\n\n> UMAP below shows that MULTIseqDemux assigned a large cluster of cells as tags in both sequencing runs rather than \"Doublet/Negative\" to HTODemux. HTODemux has been suggested to predict more false-positive doublets compared to MULTIseqDemux (see [GitHub](https://github.com/chris-mcginnis-ucsf/MULTI-seq/issues/26) & [Paper](https://academic.oup.com/bioinformatics/article-abstract/38/10/2791/6565315))\n\n## Separation of HTO Signal {#sec-htosignal}\nFurthermore we will inspect the hashtag signal for the demultiplexed cells in both samples to determine whether HTODemux or MULTIseqDemux is better.\n\n> MULTIseqDemux can separate signals from individual tags better for both sequencing runs, especially for Hashtag-8.\n\nIn the following chapters, we will continue subsequent analysis using MULTIseqDemux output rather than HTODemux.\n\n## Session Info {.unnumbered}\n\n\n","srcMarkdownNoYaml":"\n\n## Motivation {.unnumbered}\n\nFor this dataset, each sample is comprised of cells from multiple patients hashtagged with a unique oligo sequence. To demultiplex which patient the cells were retrieved from, a demultiplexing algorithm must be used to quantify the oligo sequences for each cell and assign each cell to a patient. The most common approaches to date is using the HTOdemux [[Stoeckius et al.; 2018]](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-018-1603-1) or the MULTIseqDemux [[McGinnis et al.; 2019]](https://www.nature.com/articles/s41592-019-0433-8) algorithms. Besides assigning each cell back to each patient, these algorithms are able to identify homolytic/heterolytic \"Doublet\" and \"Negative\" cells based on high/multiple and low oligo counts respectively. These poor quality droplets are a common issue with droplet-based sequencing when there are multiple or no cells found in each droplet, and removal of these droplets could prevent false-positive findings.\n\n## Calculate Gene Fractions {#sec-calculate_gene_fractions}\nBefore demultiplexing, we need to first calculate the fraction of mitochondrial, ribosomal, haemoglobin, T/B-cell recepter (TCR/BCR) and MHC reads to identify poor quality cells, which can be informative of accurate demultiplexing. The function below will perform the calculations of key parameters that identifies poor quality cells.\n  \nPlease navigate to the next chapter \\<Quality Control\\> for a detailed explanation of the wrapper function, outputs, and interpretations.\n\n## Inpect HTO Counts\nBefore demultiplexing HTO library, we will inspect and remove any redundant/low expressing hashtags. For each sample, below we will quantify 1) how many cells expresses each tag; 2) number of counts for each tag.\n\n> Quantification show that Hashtag-1 and Hashtag-2 are pretty much not expressed. Indeed for these sequencing runs, the author did not tag cells with Hashtag-1 and Hashtag-2. However author did not remove these Tags during cellranger-multi processing, hence some false-positive counts.\n\n## HTODemux {#sec-htodemux}\nFirst we will run the the wrapper function below to demultiplex the cells with the HTODemux algorithm in default settings.\n\nBelow we will visualize the output from HTODemux to inspect the quality of the demultiplexing algorithm. We quantified the percentage of \"Singlet\", \"Doublet\" and \"Negative\" cells (empty droplets or cells with no tags) for each sample. \n\n> HTODemux is able to assign > 65% of cells as \"Singlets\" for both samples.\n\nIn addition, we can inspect different parameter below to see if \"Doublet\" and \"Negative\" cells are assigned appropriately. Low nFeature/nCount typically indicate if the droplet is empty, hence \"Negative\". Vice versa, high nFeature/nCount indicate \"Doublet\" cells as mRNA contents in a droplet is doubled.\n\n> Looking at nFeature_RNA & nCounts_RNA mainly, HTODemux assignment do accurately reflect nature of the \"Negative\" and \"Doublet\" cells in our case.\n\n## MULTIseqDemux {#sec-multiseqdemux}\nNext we also will also implement MULTIseqDemux algorithm as a benchmark. \n\nBelow we will visualize the output from MULTIseqDemux to inspect the quality of demultiplexing. Again we quantified the percentage of \"Singlet\", \"Doublet\" and \"Negative\" cells for each sample. \n> Compared to HTODemux, all samples have > 70% of cells assigned as \"Singlet\".\n\nAgain, we can inspect different parameter below to see if \"Doublet\" and \"Negative\" cells are assigned appropriately.\n\n> Looking at nFeature and nCounts again, nCounts and nFeatures of \"Negative\" cells are substantially lower than \"Singlet\" cells, wheres \"Doublets\" are much higher than \"Singlet\" cells. Compared to HTODemux, MULTIseqDemux may better capture true \"Singlet\" cells.\n\n> UMAP below shows that MULTIseqDemux assigned a large cluster of cells as tags in both sequencing runs rather than \"Doublet/Negative\" to HTODemux. HTODemux has been suggested to predict more false-positive doublets compared to MULTIseqDemux (see [GitHub](https://github.com/chris-mcginnis-ucsf/MULTI-seq/issues/26) & [Paper](https://academic.oup.com/bioinformatics/article-abstract/38/10/2791/6565315))\n\n## Separation of HTO Signal {#sec-htosignal}\nFurthermore we will inspect the hashtag signal for the demultiplexed cells in both samples to determine whether HTODemux or MULTIseqDemux is better.\n\n> MULTIseqDemux can separate signals from individual tags better for both sequencing runs, especially for Hashtag-8.\n\nIn the following chapters, we will continue subsequent analysis using MULTIseqDemux output rather than HTODemux.\n\n## Session Info {.unnumbered}\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":false,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"number-sections":true,"number-offset":3,"output-file":"1.3_demux.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.549","fontsize":"0.8em","theme":["flatly"],"grid":{"sidebar-width":"350px","body-width":"1000px","margin-width":"400px","gutter-width":"1.5rem"},"monobackgroundcolor":"#f3f3f3","title":"Cell Demultiplexing","author":[{"name":"Matthew Hung"}],"date":"last-modified","date-format":"iso","toc-expand":1},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}